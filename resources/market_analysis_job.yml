resources:
  jobs:
    market_analysis:
      name: "Market Analysis - Average Yield by City"
      
      tasks:
        - task_key: run_market_analysis
          sql_task:
            warehouse_id: ${var.warehouse_id}
            query:
              query: |
                SELECT
                  dim_company.city,
                  AVG(fact_markethistory.yield) AS average_yield
                FROM
                  tpcdi.gold_market.fact_markethistory
                    JOIN tpcdi.gold_market.dim_company
                      ON fact_markethistory.sk_companyid = dim_company.sk_companyid
                GROUP BY
                  dim_company.city
                ORDER BY
                  average_yield DESC
          
          timeout_seconds: 300
      
      